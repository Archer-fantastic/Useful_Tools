# ImgCluster：基于特征的图像自动聚类工具

ImgCluster 是一款具备可视化界面的图像聚类工具，通过ResNet或MobileNet提取图像特征，结合KMeans或DBSCAN算法实现自动聚类，帮助用户快速整理大量无序图像（如相册分类、相似图片归组等）。


## 工具特点

- **可视化操作**：基于PySide6的图形界面，无需编写代码即可完成聚类
- **多种算法支持**：内置KMeans（指定类别数）和DBSCAN（密度聚类）两种算法
- **可选特征模型**：支持ResNet18/34/50和MobileNet等多种特征提取模型
- **灵活配置**：支持递归读取子文件夹、自定义聚类参数
- **自动分类保存**：聚类结果按类别分文件夹保存，方便后续整理


## 环境依赖

- Python 3.8+
- 依赖库：
  ```bash
  pip install numpy opencv-python torch torchvision scikit-learn pyside6 matplotlib
  ```


## 功能说明

### 核心原理

1. **特征提取**：使用预训练的深度学习模型（如ResNet）将图像转换为高维特征向量（抽象表示图像的视觉特征）。
2. **聚类算法**：
   - **KMeans**：需要指定聚类类别数，适合已知大致分类数量的场景。
   - **DBSCAN**：无需指定类别数，基于密度自动发现聚类，适合形状不规则的类别。
3. **结果保存**：自动按聚类结果创建文件夹（`cluster_0`、`cluster_1`...），并复制图像到对应文件夹。


## 快速开始

### 1. 运行程序

直接运行脚本：
```bash
python img_cluster.py
```
程序会启动图形界面，如下所示：
```
+------------------------------------------------+
| 图像聚类工具                                   |
|                                                |
| 文件夹设置                                     |
| 图像文件夹：[浏览...]                          |
| 保存目录：   [浏览...]                          |
|                                                |
| 参数设置                                       |
| 特征提取模型：[resnet18 ▼]                     |
| 聚类算法：   [kmeans ▼]                        |
|                                                |
| 聚类类别数：[8 ▲▼]       递归读取子文件夹 [√]   |
|                                                |
| [进度条] 就绪                                  |
|                                                |
| [开始聚类]                                     |
|                                                |
| 控制台输出：                                    |
| [10:23:45] 选择图像文件夹: /path/to/images     |
| ...                                            |
+------------------------------------------------+
```


### 2. 操作步骤

#### 步骤1：选择文件夹
- **图像文件夹**：点击"浏览"选择包含待聚类图像的文件夹（支持JPG/PNG/BMP等常见格式）。
- **保存目录**：选择聚类结果的保存路径（程序会自动创建带时间戳的子文件夹）。

#### 步骤2：配置参数
- **特征提取模型**：
  - `resnet18`：轻量快速，适合普通场景
  - `resnet50`：特征更精细，计算量较大
  - `mobilenet`：移动端模型，速度快但精度略低
- **聚类算法**：
  - **KMeans**：需设置"聚类类别数"（如8类）
  - **DBSCAN**：需设置"eps（密度半径）"和"最小样本数"（默认0.5和5）
- **递归读取子文件夹**：勾选后会扫描所有子文件夹中的图像。

#### 步骤3：开始聚类
点击"开始聚类"按钮，程序会：
1. 加载选择的特征提取模型
2. 扫描并提取图像特征（显示进度）
3. 执行聚类算法
4. 按类别保存结果到指定目录

#### 步骤4：查看结果
聚类完成后，保存目录会生成类似 `resnet18_clusters_20251030_102345` 的文件夹，内部按 `cluster_0`、`cluster_1` 等分类存放图像。


## 参数说明

| 参数             | 作用                                   | 推荐值范围       |
|------------------|----------------------------------------|------------------|
| 聚类类别数（KMeans） | 指定最终聚类的类别数量                 | 2-20（根据图像数量） |
| eps（DBSCAN）    | 密度聚类的半径，控制类别紧凑程度       | 0.3-1.0          |
| 最小样本数（DBSCAN） | 形成密集区域的最小样本数               | 3-10             |
| 递归读取         | 是否扫描子文件夹中的图像               | 按需勾选         |


## 常见问题

1. **Q：程序运行缓慢？**  
   A：特征提取依赖深度学习模型，可尝试：
   - 选择更轻量的模型（如mobilenet）
   - 减少待聚类图像数量
   - 确保电脑有NVIDIA显卡并安装CUDA（可加速计算）

2. **Q：聚类结果不理想？**  
   A：
   - KMeans：调整"聚类类别数"（尝试增大/减小）
   - DBSCAN：减小`eps`获得更多小类别，增大`eps`获得更少大类；调整"最小样本数"控制噪声过滤

3. **Q：提示"未找到图像文件"？**  
   A：检查图像文件夹路径是否正确，确保文件夹内有支持的图像格式（JPG/PNG等）。

4. **Q：模型加载失败？**  
   A：确保网络通畅（首次运行需下载预训练模型），或尝试更换其他模型。


## 扩展建议

- 增加特征降维可视化（如TSNE），直观展示聚类效果
- 支持自定义图像尺寸和数据增强，适应特殊图像场景
- 增加聚类结果预览功能，无需打开文件夹即可查看类别


通过ImgCluster，您可以快速将杂乱的图像按视觉相似性自动分组，适用于相册整理、素材分类、重复图像检测等场景。